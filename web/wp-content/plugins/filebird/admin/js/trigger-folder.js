var njt_trigger_folder={};function njt_after_loading_media(e,r){jQuery(".wrap").html(jQuery(e).find(".wrap").html()),jQuery("#folders-to-edit li").removeClass("current_folder"),jQuery("ul.jstree-container-ul li").removeClass("current-dir current_folder"),""==r||null==r||"all"==r?jQuery("#menu-item-all").addClass("current-dir"):"-1"==r?jQuery("#menu-item--1").addClass("current-dir"):jQuery("#menu-item-"+r).addClass("current_folder"),jQuery.each(filebird_taxonomies.folder.term_list,function(e,r){jQuery(".wpmediacategory-filter").append('<option value="'+r.term_id+'">'+r.term_name+"</option>")}),jQuery(".wpmediacategory-filter").val(r);var t=jQuery("#njt-filebird-attachment"),i=filebird_translate.move_1_file;jQuery.each(jQuery("table.wp-list-table tr"),function(e,r){jQuery(r).draggable({cursorAt:{top:0,left:0},helper:function(e){return jQuery("<span></span>")},start:function(e,r){var n=jQuery('.wp-list-table input[name="media[]"]:checked');n.length>0&&(i=filebird_translate.Move+" "+n.length+" "+filebird_translate.files),t.html(i),t.show(),jQuery("body").addClass("njt-draging")},stop:function(e,r){t.hide(),jQuery("body").removeClass("njt-draging")},drag:function(e,r){var i=jQuery(this).attr("id");i=i.match(/post-([\d]+)/),t.data("id",i[1]),t.css({top:e.clientY-15,left:e.clientX-15})}})}),ntWMC.filebird_finish_loading()}njt_trigger_folder.jQueryExtensions=void jQuery.fn.extend({move_folder:function(){return this.each(function(){var e=jQuery(this),r=parseInt(e.menuItemDepth(),10),t=r-1,i=e.prevAll(".menu-item-depth-"+t).first(),n=0;0!==r&&(n=i.find(".menu-item-data-db-id").val());var l=e.find(".menu-item-data-db-id").val();njt_trigger_folder.updateFolderList(l,n,"move")})}}),njt_trigger_folder.rename=function(e,r){ntWMC.filebird_begin_loading();var t={action:"filebird_ajax_update_folder_list",current:e,new_name:r,type:"rename",nonce:window.njt_fb_nonce};jQuery.post(ajaxurl,t,function(e){"error"==e?swal({title:filebird_translate.oops,text:filebird_translate.this_folder_is_already_exists,type:"error"}).then(function(){location.reload()}):"error_permission"==e&&swal({title:filebird_translate.oops,text:filebird_translate.action_failed,type:"error"}).then(function(){location.reload()})}).fail(function(){swal({title:filebird_translate.error,text:filebird_translate.error_occurred,type:"error"}).then(function(){location.reload()})}).complete(function(){ntWMC.filebird_finish_loading()})},njt_trigger_folder.delete=function(e){ntWMC.filebird_begin_loading();var r={action:"filebird_ajax_delete_folder_list",current:e,nonce:window.njt_fb_nonce};jQuery.post(ajaxurl,r,function(e){"error"==e&&swal({title:filebird_translate.error,text:filebird_translate.folder_cannot_be_delete,type:"error"}).then(function(){location.reload()})}).fail(function(){swal({title:filebird_translate.error,text:filebird_translate.error_occurred,type:"error"}).then(function(){location.reload()})}).success(function(r){ntWMC.updateCountAfternDeleteFolder(r),jQuery(".menu-item.uncategory .jstree-anchor").addClass("need-refresh"),e==localStorage.getItem("current_folder")&&localStorage.removeItem("current_folder");var t=jQuery("#menu-item-"+e).find(".menu-item-data-parent-id").val();t&&(jQuery(".menu-item .menu-item-data-parent-id").filter(function(){return jQuery(this).val()==t}).length||jQuery("#menu-item-"+t+" .dh-tree-icon").removeClass("open close")),jQuery("#menu-item-"+e).remove(),ntWMC.filebird_finish_loading()})},njt_trigger_folder.new=function(e,r){ntWMC.filebird_begin_loading();var t={action:"filebird_ajax_update_folder_list",new_name:e,parent:r,folder_type:"default",type:"new",nonce:window.njt_fb_nonce};jQuery.post(ajaxurl,t,function(e){"error"==e&&swal({title:filebird_translate.error,text:filebird_translate.folder_cannot_be_delete,type:"error"}).then(function(){location.reload()})}).fail(function(){swal({title:filebird_translate.error,text:filebird_translate.error_occurred,type:"error"}).then(function(){location.reload()})}).success(function(e){filebird_taxonomies.folder.term_list.push({term_id:e.data.term_id,term_name:"new tmp folder"});var r=jQuery(".filebird_sidebar"),t=ntWMC.ntWMCgetBackboneOfMedia(r);if("object"==typeof t.view){var i=t.view.toolbar.get("folder-filter");"object"==typeof t.view&&i.createFilters()}var n=jQuery("<option></option>").attr("value",e.data.term_id).text("new tmp folder");jQuery(".wpmediacategory-filter").append(n),jQuery(".jstree-anchor.jstree-clicked").removeClass("jstree-clicked"),njt_trigger_folder.update_folder_position(),ntWMC.filebird_finish_loading()})},njt_trigger_folder.updateFolderList=function(e,r,t){var i={action:"filebird_ajax_update_folder_list",current:e,new_name:0,parent:r,type:t,folder_type:"folder",nonce:window.njt_fb_nonce};jQuery.post(ajaxurl,i,function(e){"error"==e?swal({title:filebird_translate.oops,text:filebird_translate.this_folder_is_already_exists,type:"error"}).then(function(){location.reload()}):"error_permission"==e?swal({title:filebird_translate.oops,text:filebird_translate.action_failed,type:"error"}).then(function(){location.reload()}):(njt_trigger_folder.update_folder_position(),jQuery(".need-refresh").trigger("click"))}).fail(function(){swal({title:filebird_translate.error,text:filebird_translate.error_occurred,type:"error"}).then(function(){location.reload()})})},njt_trigger_folder.update_folder_position=function(){ntWMC.filebird_begin_loading();var e="",r=0;jQuery("#njt-filebird-folderTree .menu-item-data-db-id").each(function(){r++,""!=e&&(e+="|"),e=e+jQuery(this).val()+","+r});var t={action:"filebird_ajax_update_folder_position",nonce:window.njt_fb_nonce,result:e};jQuery.post(ajaxurl,t,function(e){"error"==e&&swal({title:filebird_translate.oops,text:filebird_translate.something_not_correct+filebird_translate.this_page_will_reload,type:"error"}).then(function(){location.reload()}),ntWMC.filebird_finish_loading()}).fail(function(){ntWMC.filebird_finish_loading(),swal({title:filebird_translate.error,text:filebird_translate.error_occurred,type:"error"}).then(function(){location.reload()})}).success(function(e){var r=jQuery(".wpmediacategory-filter").val();jQuery("#menu-item-"+r+" .jstree-anchor").addClass("need-load-children"),jQuery("#menu-item-"+r+" .jstree-anchor").trigger("click")})},njt_trigger_folder.filter_media=function(e){if(null==e);else{var r=e.closest(".menu-item").data("id");if(jQuery(".need-refresh").length||jQuery(".filebird-treeview").length){var t=jQuery(".filebird_sidebar"),i=ntWMC.ntWMCgetBackboneOfMedia(t);if(i.browser.length>0&&"object"==typeof i.view)try{i.view.collection.props.set({ignore:+new Date})}catch(e){console.log(e)}jQuery(".need-refresh").removeClass("need-refresh")}jQuery(".wpmediacategory-filter").val(r),jQuery(".wpmediacategory-filter").trigger("change"),jQuery(".attachments").css("height","auto")}},njt_trigger_folder.getChildFolder=function(e){jQuery(".njt-filebird-container").length&&jQuery(".njt-filebird-container").remove();var r={action:"filebird_ajax_get_child_folders",nonce:window.njt_fb_nonce,folder_id:e};jQuery.post(ajaxurl,r,function(e){}).fail(function(){}).success(function(e){njt_folder_in_content.render(e.data)})},jQuery("#njt-filebird-folderTree .jstree-anchor").dblclick(function(e){e.preventDefault()}),jQuery(document).ready(function(){var e=null;jQuery(document).on("click",".filebird_sidebar .jstree-anchor",function(r){var t=jQuery(this),i=t.closest(".menu-item").data("id");t.hasClass("clicked")?(t.removeClass("clicked"),clearTimeout(e),jQuery(".js__nt_rename").trigger("click")):(t.addClass("clicked"),setTimeout(function(){if(t.hasClass("clicked"))if(t.removeClass("clicked"),jQuery('select[name="njt_filebird_folder"]').length){if(jQuery('select[name="njt_filebird_folder"]').val(i),jQuery(".njt-filebird-loader").hasClass("loading"))return;ntWMC.filebird_begin_loading(),e=setTimeout(function(){for(var e=jQuery("#posts-filter").serializeArray(),r=0;r<e.length;++r)"paged"==e[r].name&&(e[r].value=1),"attachment-filter"==e[r].name&&e.splice(r,1),"m"==e[r].name&&e.splice(r,1);e=jQuery.param(e),jQuery.ajax({url:njt_filebird_dh.upload_url,type:"GET",data:e}).done(function(r){window.history.pushState({},"",njt_filebird_dh.upload_url+"?"+e),njt_after_loading_media(r,i)}).fail(function(){ntWMC.filebird_finish_loading(),console.log("error")}),oldCurrentFolder=localStorage.getItem("current_folder")},200)}else e=setTimeout(function(){njt_trigger_folder.filter_media(t),(oldCurrentFolder!=localStorage.getItem("current_folder")||t.hasClass("need-load-children"))&&(jQuery("body.wp-admin.upload-php").length&&njt_trigger_folder.getChildFolder(i),t.removeClass("need-load-children")),oldCurrentFolder=localStorage.getItem("current_folder")},200)},500))}),jQuery(document).on("click","body.wp-admin.upload-php .pagination-links a",function(e){e.preventDefault();var r=jQuery(this);if(!jQuery(".njt-filebird-loader").hasClass("loading"))return ntWMC.filebird_begin_loading(),jQuery.ajax({url:r.attr("href"),type:"GET",data:{}}).done(function(e){window.history.pushState({},"",r.attr("href")),njt_after_loading_media(e,jQuery('select[name="njt_filebird_folder"]').val())}).fail(function(){ntWMC.filebird_finish_loading(),console.log("error")}),!1}),jQuery("body.wp-admin.upload-php").length&&jQuery(document).on("submit","#posts-filter",function(e){if(e.preventDefault(),!jQuery(".njt-filebird-loader").hasClass("loading")){ntWMC.filebird_begin_loading();for(var r=jQuery(document.activeElement).attr("name"),t=jQuery(document.activeElement).val(),i=jQuery("#posts-filter").serialize(),n=jQuery("#posts-filter").serializeArray(),l=!1,a=0;a<n.length;++a)"s"==n[a].name&&""!==n[a].value&&(l=!0),"paged"==n[a].name&&n.splice(a,1);return n=jQuery.param(n),"delete_all"==r&&(i=i+"&"+r+"="+t,n=n+"&"+r+"="+t),i=!0===l?n:i,jQuery.ajax({url:njt_filebird_dh.upload_url,type:"GET",data:i}).done(function(e){window.history.pushState({},"",njt_filebird_dh.upload_url+"?"+i),njt_after_loading_media(e,jQuery('select[name="njt_filebird_folder"]').val())}).fail(function(){ntWMC.filebird_finish_loading(),console.log("error")}),!1}})});